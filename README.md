# Finding-exploits-in-HDF5
The Hierarchical Data Format version 5 (HDF5), is an open source file format for large data used in scientific fields


<p>
Download HDF5 version 1.14.0
</p>

```
https://portal.hdfgroup.org/display/support/HDF5+1.14.0
```
<p>
Unpack the HDF5 file
</p
```
tar -xvf hdf5-1.14.0.tar.gz 
```

<p>
Download build essentail to get GCC compiler
</p>

```
$ sudo apt install build-essential
```

<p>
Install AFL to get AFL-Clang-fast and AFL-CLANG-fast++ compilers
</p>

```
apt-get install afl
```

<p>
cd into the HDF5 directory and set up the compilers and build
</p>

```
export CC=/usr/bin/afl-clang-fast
export CXX=/usr/bin/afl-clang-fast++
cd ~/HDF5+1.14.0/
./configure --disable-shared --enable-static-exec && make
```

<p>
In the HDF5+1.14.0 directory, create an in file for the seed, and out file for the output and a file for the corpus
</p>

```
cd ~/HDF5+1.14.0/
mkdir in
mkdir corpus
mkdir out
````

[POC.zip](https://github.com/sascha47/Finding-exploits-in-HDF5/raw/e81776b87d591ddc21629c474d15f65fc951e8d1/poc.zip)



<p>
Set up enviromental variables for the fuzzing
</p>

```
TARGET=~/HDF5+1.14.0/tools/src/h5diff/h5diff

BASE_MODEL=~/HDF5+1.14.0/in/plain_model.h5

IN_DIR=~/HDF5+1.14.0/in

OUT_DIR=~/HDF5+1.14.0/out

```
<p>
Now run Afl Fuzz.
</p>

```
afl-fuzz -i $IN_DIR -o $OUT_DIR -M fuzz00 $TARGET $BASE_MODEL @@
```
<p>
Wait for 1 minute or 2 to collect crashes and then navigate to the directory with the crashes
</p>

```
~/HDF5+1.14.0/fuzz00/out/crashes
```
<p> 
 copy a crash and then run it against the HDF5 application the same way you fuzzed
</p>

```
~/hdf5-1.14.0/tools/src/h5diff/h5diff ~/hdf5-1.14.0/in/plain_model.h5 ~/hdf5-1.14.0/out/fuzz00/crashes/id:000007,sig:11,src:000000,op:flip1,pos:1088
```
<p>
  you should get a segmentation error and to see where it breaks in the actual coding we need to decompile the code with gdb after installing it
 </p>
 
```
apt-get install gdb

gdb -ex=r --args ~/hdf5-1.14.0/tools/src/h5diff/h5diff  ~/hdf5-1.14.0/in/plain_model.h5 ~/hdf5-1.14.0/out/fuzz00/crashes/id:000007,sig:11,src:000000,op:flip1,pos:1088
```
<p>
  
  After running the decompiler , enter bt for backtrace
</p>

<p>
  You should be able to see where the application crashed, the line and function
</p>

<p> 
  Next you want to recompile with default gcc and re run the application with the bug to ensure that the system still crashes and also keep the build the same
</p>

```
unset CC
unset CXX
cd ~/hdf5-1.14.0/
./configure --disable-shared --enable-static-exec && make
```

<p>
Re run the program with the bug
</p>

```
~/hdf5-1.14.0/tools/src/h5diff/h5diff ~/hdf5-1.14.0/in/plain_model.h5 ~/hdf5-1.14.0/out/fuzz00/crashes/id:000007,sig:11,src:000000,op:flip1,pos:1088
```

<p>
 you should receive a segementation error which is the same error when compiled with afl-clang
</p>

<p>
 
You have succesffuly found a bug in HDF5 using afl-fuzz and are ready to file your first report
 </p>

